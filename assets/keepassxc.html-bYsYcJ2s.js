import{_ as a,c as s,a as t,o as n}from"./app-Cs446qsf.js";const i={};function o(r,e){return n(),s("div",null,e[0]||(e[0]=[t(`<h1 id="how-to-set-up-keepassxc" tabindex="-1"><a class="header-anchor" href="#how-to-set-up-keepassxc"><span>How to set up KeepassXC</span></a></h1><p>SSH has some of the dumbest ideas in UX.</p><p>Rather than use the fact that the person responsible for the creation of this program is capable of such stupidity so as to discredit ssh, we politely forgive them for flaunting &quot;I am a security expert&quot; as if that makes their stupidity <em>more forgivable</em>.</p><p>Enough ranting though.</p><p>We&#39;re here to set up KeePassXC on a clean Arch installation as an SSH agent.</p><h2 id="keepassxc" tabindex="-1"><a class="header-anchor" href="#keepassxc"><span>KeePassXC</span></a></h2><p>KeePassXC is probably my favourite application on Linux. It gives me local control over passwords, the option to use a cloud, and access to it on mobile operating systems.</p><p>Here we&#39;re mostly talking about how to use KeePassXC to reduce the amount of typing of keys into the program. The less you input your password into the computer, the harder it is to crack. Nobody can eavesdrop on you inserting your key, and make a correlation. While you could avoid being side-channelled in such a way by swapping around the switches on your keyboard on a regular basis, this is still not an exact solution.</p><p>Plus, I often found that <em>good</em> security practices, <em>i.e.</em> common sense, comes with no compromises to the user experience. So, without further ado,</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">pkexec pacman <span class="token parameter variable">-S</span> keepassxc</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>I&#39;m using <code>pkexec</code> for a few reasons. Probably the most important one is that it offers me a graphical interface to enter the password. Another is that it actually provides feedback on the entered password. It is also more often than not pre-installed and runs on the TTY as well as in the graphical system (though you should be careful to have D-Bus running). While <code>sudo</code> may have had good reasons for not showing any of that, I don&#39;t think that it is necessarily smart. Finally, I have found on so many occasions that a long lasting build failed to catch my eye and timed out when using <code>paru</code>, when using <code>sudo</code>. Using <code>pkexec</code> has one minor drawback when used in <code>paru</code>, that it requests your password more than once during a single install, but I think if that annoys you, you should consider creating a rule for that (article coming soon).</p></div><p>The next step is to create a database. I&#39;d recommend that you consider making your database portable; there&#39;s advantages to having multiple databases, and advantages to securing your database with something more reliable than just a password. However, I personally find that the value that it offers is marginal.</p><p>Sure, it is <em>more</em> secure to try and use a YubiKey (one of my favourite investments), to unlock your database <em>in addition</em> to a strong password that you change on a regular basis. But the attack vector that I&#39;m covering is <em>not what you might think</em>. In particular, I&#39;m not trying to protect myself from a world collapse scenario, nor am I pretending to protect myself from alphabetical organisations all around the world. Instead, I&#39;m trying to protect myself from a person who is likely to take interest in me, but also not to be too technical: your average thief and black hat. Those people do not, as a rule, go and attack people personally, but rather in bulk. They breach LastPass (and I happened to be stupid enough to have an account with them), among a few others. This means that the most likely attacker is a script kiddie. They go after personal information in cloud storage as well, so keeping my password database in Dropbox, while convenient, is likely not worth it. However, assuming that I don&#39;t leave my flash drives out and about (and I don&#39;t), and transport the keys and password databases only locally, then the only way to breach my security is by breaching my machines as well. Regardless, it only makes sense to protect my work machine from malware/key-loggers, and to avoid using cloud services. At this point, if people have access to my machine, they could compromise my password, but not the YubiKey. And yes, at this point the YubiKey is doing the legwork, but it is also a piece of hardware that can potentially lock me out of information that I should be able to recover. It is in my opinion better to not lose the information I have access to via password databases, and potentially grant this information to malicious actors, than it is to potentially lock myself out of it.</p><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>I would caution the reader to be aware that this only represents the state of things <strong>at the time of writing</strong>.</p><p>The risk/benefit analysis has to be revisited every single time something changes in the <em>status quo</em>.</p><p>I myself am experimenting with using a YubiKey as the only factor in authentication.</p></div><h2 id="creating-ssh-keys" tabindex="-1"><a class="header-anchor" href="#creating-ssh-keys"><span>Creating SSH keys</span></a></h2><p>The command we want is interactive:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">ssh-keygen <span class="token parameter variable">-t</span> ed25519</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This will prompt you for some input, and I would recommend that you follow the defaults.</p><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>Don&#39;t try to avoid setting a passphrase. This is not a good idea for one simple reason: your key is <em>the key</em>, if you want to encrypt it, you must encrypt it either with another key, or another key that&#39;s derived from your password. I know that it is tedious to input a long password into your terminal any time you want to use a program like <code>ssh</code> or <code>gpg</code> to sign your commits, but I assure you, setting a long password is of paramount importance. The rest of this article is dedicated to making the tedium more manageable, so I&#39;d advise you to heed this warning.</p></div><details class="hint-container details"><summary>An aside on our chosen method</summary><p>We are going to go with the <a href="https://www.ssh.com/academy/ssh/keygen" target="_blank" rel="noopener noreferrer">defaults</a>. This is somewhat dangerous, because it assumes that people developing <code>ssh</code> know what they&#39;re doing, and as I asserted earlier, user experience blunders seem to cast doubt on that. Still, I&#39;ve worked in cryptography, and I should say that <code>ed25519</code> is a relatively safe bet. What isn&#39;t safe is relying on the same key for a long time.</p></details><details class="hint-container details"><summary>Changing keys and passwords frequently</summary><p>I am torn on the idea of updating one&#39;s credentials regularly. I think that with passwords, there can be a very compelling argument against changing them frequently: this is a potential point of vulnerability, it requires a very specific architecture on the back-end, and quite frankly can lead you to forget the password. If you can make it work, this will probably protect you from attacks via data breaches, and improve the <em>effective</em> strength of your passwords. With that said, it will probably result in you forgetting the password, and having to fix it in some other fashion, which intrinsically makes the system less secure.</p><p>With keys, the balance of updating them is very different. Either they are used as the address and thus identifier in some piece of software, or it is treated as a password. If it&#39;s the former, you simply <em>can&#39;t</em> change your key and that&#39;s that. But GitHub and GitLab and most other systems that use your ssh key, do so as a password, and in this case, there is almost always an additional layer of security which you must go through. As such, there are very few actual downsides to changing your keys, as long as you&#39;re thorough with the changes.</p></details><h2 id="getting-the-ssh-agent-to-work" tabindex="-1"><a class="header-anchor" href="#getting-the-ssh-agent-to-work"><span>Getting the <code>ssh-agent</code> to work</span></a></h2><p>This is somewhat of a problem, because (at least on KDE), none of the regular plumbing for setting it up works.</p><p>I also have quite an esoteric set-up, because I mostly use <code>fish</code> and I use it as my login shell. There are differing opinions on whether a non-POSIX compliant shell is a good thing, and that maybe the difficulties that I&#39;m facing are all due to deviating from the norm. But I&#39;m a contrarian, and to make this term worth something I need to do extra work to get anything to work.</p><p>Firstly, you should probably add the <code>ssh-agent</code> to the list of services that you need.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">systemctl <span class="token builtin class-name">enable</span> <span class="token parameter variable">--user</span> <span class="token parameter variable">--now</span> ssh-agent</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This is a service file that was thoughtfully provided by the maintainers of Arch Linux. Not many are aware that it exists, but if it didn&#39;t here&#39;s what it looks like on my machine:</p><div class="language-systemd line-numbers-mode" data-highlighter="prismjs" data-ext="systemd"><pre><code><span class="line"><span class="token comment"># Requires SSH_AUTH_SOCK=&quot;$XDG_RUNTIME_DIR/ssh-agent.socket&quot; to be set in environment</span></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span></span>
<span class="line"><span class="token key attr-name">ConditionEnvironment</span><span class="token punctuation">=</span><span class="token value attr-value">!SSH_AGENT_PID</span></span>
<span class="line"><span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">OpenSSH key agent</span></span>
<span class="line"><span class="token key attr-name">Documentation</span><span class="token punctuation">=</span><span class="token value attr-value">man:ssh-agent(1) man:ssh-add(1) man:ssh(1)</span></span>
<span class="line"></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span></span>
<span class="line"><span class="token key attr-name">Environment</span><span class="token punctuation">=</span><span class="token value attr-value">SSH_AUTH_SOCK=%t/ssh-agent.socket</span></span>
<span class="line"><span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/bin/ssh-agent -D -a $SSH_AUTH_SOCK</span></span>
<span class="line"><span class="token key attr-name">PassEnvironment</span><span class="token punctuation">=</span><span class="token value attr-value">SSH_AGENT_PID</span></span>
<span class="line"><span class="token key attr-name">SuccessExitStatus</span><span class="token punctuation">=</span><span class="token value attr-value">2</span></span>
<span class="line"><span class="token key attr-name">Type</span><span class="token punctuation">=</span><span class="token value attr-value">simple</span></span>
<span class="line"></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span></span>
<span class="line"><span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">default.target</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Next you would need to add an environment variable <code>SSH_AUTH_SOCK</code> to your shell. There is currently no consensus on how to do it, but plenty of opinionated idealists with ideas of why a way works isn&#39;t what you should use. At the moment, the way that evidently works best is to add a file in <code>~/.config/environment.d/</code>,</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&#39;SSH_AUTH_SOCK=&quot;\${XDG_RUNTIME_DIR}/ssh-agent.socket&quot;&#39;</span> <span class="token operator">&gt;&gt;</span> ~/.config/environment.d/ssh-askpass.conf</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>I cannot emphasise enough how badly user-specific environment variables are handled on GNU. Particularly those pertaining to the early programs like window managers and security agents.</p><p>Now you need to log out and in again.</p><div class="hint-container info"><p class="hint-container-title">Info</p><p>A Restart is what I&#39;d recommend for that purpose, on Arch Linux it might have other benefits, particularly if you&#39;ve ran <code>pacman -Syu</code> before.</p></div><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>To verify that things work now, run</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">ssh-add <span class="token parameter variable">-l</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>if it produces something like this:</p><div class="language-console line-numbers-mode" data-highlighter="prismjs" data-ext="console"><pre><code><span class="line">The agent has no identities.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>then we&#39;re good</p></div><h2 id="setting-up-keepassxc" tabindex="-1"><a class="header-anchor" href="#setting-up-keepassxc"><span>Setting up KeePassXC</span></a></h2><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>We are largely going to closely follow the <a href="https://github.com/keepassxreboot/keepassxc/blob/develop/docs/topics/SSHAgent.adoc" target="_blank" rel="noopener noreferrer">upstream documentation</a>: if the two documents differ, I&#39;d recommend you more closely follow the upstream document rather than the steps outlined here.</p></div><h2 id="pinentry-for-gnu-privacy-guard-gnupg" tabindex="-1"><a class="header-anchor" href="#pinentry-for-gnu-privacy-guard-gnupg"><span><code>pinentry</code> for GNU Privacy Guard (<code>gnupg</code>)</span></a></h2><p>This is probably something that could be left for another post, but I&#39;m adding it here for posterity. Firstly, there&#39;s an asymmetry between the <code>pinentry</code> programs. <code>pinentry-qt</code> is, as always, an afterthought. <code>pinentry-gnome3</code> has integration with the secret services, meaning that you could enable KeePassXC&#39;s secret service integration, and be done with it.</p><p>The easiest way to achieve it, is by setting the following in <code>.gnupg/gpg-agent.conf</code></p><div class="language-conf line-numbers-mode" data-highlighter="prismjs" data-ext="conf"><pre><code><span class="line">pinentry-program /usr/bin/pinentry-gnome3</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This program, at the time of writing will not start, you need to also install <code>gcr</code> of the third version.</p><p>At this point, you might want to disable the KDE wallet subsystem, so that it&#39;s not exactly competing with KeePassXC, and enable the service with KeePassXC.</p><p>The best thing to do is to now test things!</p>`,43)]))}const c=a(i,[["render",o],["__file","keepassxc.html.vue"]]),p=JSON.parse('{"path":"/posts/keepassxc.html","title":"How to set up KeepassXC","lang":"en-GB","frontmatter":{"category":["Guide","Systems Administration","Privacy"],"date":"2024-01-15T00:00:00.000Z"},"headers":[{"level":2,"title":"KeePassXC","slug":"keepassxc","link":"#keepassxc","children":[]},{"level":2,"title":"Creating SSH keys","slug":"creating-ssh-keys","link":"#creating-ssh-keys","children":[]},{"level":2,"title":"Getting the ssh-agent to work","slug":"getting-the-ssh-agent-to-work","link":"#getting-the-ssh-agent-to-work","children":[]},{"level":2,"title":"Setting up KeePassXC","slug":"setting-up-keepassxc","link":"#setting-up-keepassxc","children":[]},{"level":2,"title":"pinentry for GNU Privacy Guard (gnupg)","slug":"pinentry-for-gnu-privacy-guard-gnupg","link":"#pinentry-for-gnu-privacy-guard-gnupg","children":[]}],"git":{"updatedTime":1742748808000,"contributors":[{"name":"Aleksandr Petrosyan","username":"","email":"ap886@cantab.ac.uk","commits":7}],"changelog":[{"hash":"2504feacfc8e83978d0f3b7c3a3f7df06b5b48c6","time":1742748808000,"email":"ap886@cantab.ac.uk","author":"Aleksandr Petrosyan","message":"[vuepress]: Migrating articles"},{"hash":"bc5bda253540556643ed855b2cd5c7ee23c67889","time":1742747283000,"email":"ap886@cantab.ac.uk","author":"Aleksandr Petrosyan","message":"[vuepress]: Initial migration"},{"hash":"70fc7731d54e773749072f4ab416139f60051fc0","time":1718540815000,"email":"ap886@cantab.ac.uk","author":"Aleksandr Petrosyan","message":"[article]: Emacs keybindings"},{"hash":"ccc6b7237213b992053c599ecbb84b69648fe696","time":1705425752000,"email":"ap886@cantab.ac.uk","author":"Aleksandr Petrosyan","message":"[touchups]: ssh-agent"},{"hash":"3544aadea74d22773b882b461e3d6ec7ad85d361","time":1705337534000,"email":"ap886@cantab.ac.uk","author":"Aleksandr Petrosyan","message":"[guides]: Section on Keepass"},{"hash":"251477e9ee1bc62496a76cd3d25bf7f0f2c43432","time":1705334402000,"email":"ap886@cantab.ac.uk","author":"Aleksandr Petrosyan","message":"[guides]: Extend <code>ssh-agent</code> section"},{"hash":"daeb6c2e6ad3f698bd3916e26e4a8e14aab3b0aa","time":1705328723000,"email":"ap886@cantab.ac.uk","author":"Aleksandr Petrosyan","message":"[guide]: ssh-agent"}]},"filePathRelative":"posts/keepassxc.md","excerpt":"\\n<p>SSH has some of the dumbest ideas in UX.</p>\\n<p>Rather than use the fact that the person responsible for the creation of this program is capable of such stupidity so as to discredit ssh, we politely forgive them for flaunting \\"I am a security expert\\" as if that makes their stupidity <em>more forgivable</em>.</p>"}');export{c as comp,p as data};
