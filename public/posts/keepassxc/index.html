<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  How to set up KeepassXC · Aleksandr Petrosyan
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Aleksandr Petrosyan">
<meta name="description" content="SSH has some of the dumbest ideas in UX.
Rather than use the fact that the person responsible for the creation of this program is capable of such stupidity so as to discredit ssh, we politely forgive them for flaunting &ldquo;I am a security expert&rdquo; as if that makes their stupidity more forgivable.
Enough ranting though.
We&rsquo;re here to set up KeePassXC on a clean Arch installation as an SSH agent.">
<meta name="keywords" content="blog,developer,personal">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="How to set up KeepassXC">
  <meta name="twitter:description" content="SSH has some of the dumbest ideas in UX.
Rather than use the fact that the person responsible for the creation of this program is capable of such stupidity so as to discredit ssh, we politely forgive them for flaunting “I am a security expert” as if that makes their stupidity more forgivable.
Enough ranting though.
We’re here to set up KeePassXC on a clean Arch installation as an SSH agent.">

<meta property="og:url" content="http://localhost:1313/posts/keepassxc/">
  <meta property="og:site_name" content="Aleksandr Petrosyan">
  <meta property="og:title" content="How to set up KeepassXC">
  <meta property="og:description" content="SSH has some of the dumbest ideas in UX.
Rather than use the fact that the person responsible for the creation of this program is capable of such stupidity so as to discredit ssh, we politely forgive them for flaunting “I am a security expert” as if that makes their stupidity more forgivable.
Enough ranting though.
We’re here to set up KeePassXC on a clean Arch installation as an SSH agent.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-15T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-01-15T00:00:00+00:00">
    <meta property="article:tag" content="Guide">
    <meta property="article:tag" content="Systems Administration">
    <meta property="article:tag" content="Privacy">




<link rel="canonical" href="http://localhost:1313/posts/keepassxc/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="/img/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      Aleksandr Petrosyan
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/keepassxc/">
              How to set up KeepassXC
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2024-01-15T00:00:00Z">
                January 15, 2024
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              9-minute read
            </span>
          </div>
          
          
          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/guide/">Guide</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/systems-administration/">Systems Administration</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/privacy/">Privacy</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <p>SSH has some of the dumbest ideas in UX.</p>
<p>Rather than use the fact that the person responsible for the creation of this program is capable of such stupidity so as to discredit ssh, we politely forgive them for flaunting &ldquo;I am a security expert&rdquo; as if that makes their stupidity <em>more forgivable</em>.</p>
<p>Enough ranting though.</p>
<p>We&rsquo;re here to set up KeePassXC on a clean Arch installation as an SSH agent.</p>
<h2 id="keepassxc">
  KeePassXC
  <a class="heading-link" href="#keepassxc">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>KeePassXC is probably my favourite application on Linux.
It gives me local control over passwords, the option to use a cloud, and access to it on mobile operating systems.</p>
<p>Here we&rsquo;re mostly talking about how to use KeePassXC to reduce the amount of typing of keys into the program.
The less you input your password into the computer, the harder it is to crack.
Nobody can eavesdrop on you inserting your key, and make a correlation.
While you could avoid being side-channelled in such a way by swapping around the switches on your keyboard on a regular basis, this is still not an exact solution.</p>
<p>Plus, I often found that <em>good</em> security practices, <em>i.e.</em> common sense, comes with no compromises to the user experience.
So, without further ado,</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>pkexec pacman -S keepassxc
</span></span></code></pre></div><p>::: tip
I&rsquo;m using <code>pkexec</code> for a few reasons.
Probably the most important one is that it offers me a graphical interface to enter the password.
Another is that it actually provides feedback on the entered password.
It is also more often than not pre-installed and runs on the TTY as well as in the graphical system (though you should be careful to have D-Bus running).
While <code>sudo</code> may have had good reasons for not showing any of that, I don&rsquo;t think that it is necessarily smart.
Finally, I have found on so many occasions that a long lasting build failed to catch my eye and timed out when using <code>paru</code>, when using <code>sudo</code>.
Using <code>pkexec</code> has one minor drawback when used in <code>paru</code>, that it requests your password more than once during a single install, but I think if that annoys you, you should consider creating a rule for that (article coming soon).
:::</p>
<p>The next step is to create a database.
I&rsquo;d recommend that you consider making your database portable; there&rsquo;s advantages to having multiple databases, and advantages to securing your database with something more reliable than just a password.
However, I personally find that the value that it offers is marginal.</p>
<p>Sure, it is <em>more</em> secure to try and use a YubiKey (one of my favourite investments), to unlock your database <em>in addition</em> to a strong password that you change on a regular basis.
But the attack vector that I&rsquo;m covering is <em>not what you might think</em>.
In particular, I&rsquo;m not trying to protect myself from a world collapse scenario, nor am I pretending to protect myself from alphabetical organisations all around the world.
Instead, I&rsquo;m trying to protect myself from a person who is likely to take interest in me, but also not to be too technical: your average thief and black hat.
Those people do not, as a rule, go and attack people personally, but rather in bulk.
They breach LastPass (and I happened to be stupid enough to have an account with them), among a few others.
This means that the most likely attacker is a script kiddie.
They go after personal information in cloud storage as well, so keeping my password database in Dropbox, while convenient, is likely not worth it.
However, assuming that I don&rsquo;t leave my flash drives out and about (and I don&rsquo;t), and transport the keys and password databases only locally, then the only way to breach my security is by breaching my machines as well.
Regardless, it only makes sense to protect my work machine from malware/key-loggers, and to avoid using cloud services.
At this point, if people have access to my machine, they could compromise my password, but not the YubiKey.
And yes, at this point the YubiKey is doing the legwork, but it is also a piece of hardware that can potentially lock me out of information that I should be able to recover.
It is in my opinion better to not lose the information I have access to via password databases, and potentially grant this information to malicious actors, than it is to potentially lock myself out of it.</p>
<p>::: warning
I would caution the reader to be aware that this only represents the state of things <strong>at the time of writing</strong>.</p>
<p>The risk/benefit analysis has to be revisited every single time something changes in the <em>status quo</em>.</p>
<p>I myself am experimenting with using a YubiKey as the only factor in authentication.
:::</p>
<h2 id="creating-ssh-keys">
  Creating SSH keys
  <a class="heading-link" href="#creating-ssh-keys">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>The command we want is interactive:</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ssh-keygen -t ed25519
</span></span></code></pre></div><p>This will prompt you for some input, and I would recommend that you follow the defaults.</p>
<p>::: warning
Don&rsquo;t try to avoid setting a passphrase.
This is not a good idea for one simple reason: your key is <em>the key</em>, if you want to encrypt it, you must encrypt it either with another key, or another key that&rsquo;s derived from your password.
I know that it is tedious to input a long password into your terminal any time you want to use a program like <code>ssh</code> or <code>gpg</code> to sign your commits, but I assure you, setting a long password is of paramount importance.
The rest of this article is dedicated to making the tedium more manageable, so I&rsquo;d advise you to heed this warning.
:::</p>
<p>::: details An aside on our chosen method
We are going to go with the <a href="https://www.ssh.com/academy/ssh/keygen"  class="external-link" target="_blank" rel="noopener">defaults</a>.
This is somewhat dangerous, because it assumes that people developing <code>ssh</code> know what they&rsquo;re doing, and as I asserted earlier, user experience blunders seem to cast doubt on that.
Still, I&rsquo;ve worked in cryptography, and I should say that <code>ed25519</code> is a relatively safe bet.
What isn&rsquo;t safe is relying on the same key for a long time.
:::</p>
<p>::: details Changing keys and passwords frequently
I am torn on the idea of updating one&rsquo;s credentials regularly.
I think that with passwords, there can be a very compelling argument against changing them frequently: this is a potential point of vulnerability, it requires a very specific architecture on the back-end, and quite frankly can lead you to forget the password.
If you can make it work, this will probably protect you from attacks via data breaches, and improve the <em>effective</em> strength of your passwords.
With that said, it will probably result in you forgetting the password, and having to fix it in some other fashion, which intrinsically makes the system less secure.</p>
<p>With keys, the balance of updating them is very different.
Either they are used as the address and thus identifier in some piece of software, or it is treated as a password.
If it&rsquo;s the former, you simply <em>can&rsquo;t</em> change your key and that&rsquo;s that.
But GitHub and GitLab and most other systems that use your ssh key, do so as a password, and in this case, there is almost always an additional layer of security which you must go through.
As such, there are very few actual downsides to changing your keys, as long as you&rsquo;re thorough with the changes.
:::</p>
<h2 id="getting-the-ssh-agent-to-work">
  Getting the <code>ssh-agent</code> to work
  <a class="heading-link" href="#getting-the-ssh-agent-to-work">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>This is somewhat of a problem, because (at least on KDE), none of the regular plumbing for setting it up works.</p>
<p>I also have quite an esoteric set-up, because I mostly use <code>fish</code> and I use it as my login shell.
There are differing opinions on whether a non-POSIX compliant shell is a good thing, and that maybe the difficulties that I&rsquo;m facing are all due to deviating from the norm.
But I&rsquo;m a contrarian, and to make this term worth something I need to do extra work to get anything to work.</p>
<p>Firstly, you should probably add the <code>ssh-agent</code> to the list of services that you need.</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>systemctl enable --user --now ssh-agent
</span></span></code></pre></div><p>This is a service file that was thoughtfully provided by the maintainers of Arch Linux. Not many are aware that it exists, but if it didn&rsquo;t here&rsquo;s what it looks like on my machine:</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-systemd" data-lang="systemd"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Requires SSH_AUTH_SOCK=&#34;$XDG_RUNTIME_DIR/ssh-agent.socket&#34; to be set in environment</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">[Unit]</span>
</span></span><span style="display:flex;"><span>ConditionEnvironment<span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">!SSH_AGENT_PID</span>
</span></span><span style="display:flex;"><span>Description<span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">OpenSSH key agent</span>
</span></span><span style="display:flex;"><span>Documentation<span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">man:ssh-agent(1) man:ssh-add(1) man:ssh(1)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">[Service]</span>
</span></span><span style="display:flex;"><span>Environment<span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">SSH_AUTH_SOCK=%t/ssh-agent.socket</span>
</span></span><span style="display:flex;"><span>ExecStart<span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">/usr/bin/ssh-agent -D -a $SSH_AUTH_SOCK</span>
</span></span><span style="display:flex;"><span>PassEnvironment<span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">SSH_AGENT_PID</span>
</span></span><span style="display:flex;"><span>SuccessExitStatus<span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">2</span>
</span></span><span style="display:flex;"><span>Type<span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">simple</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">[Install]</span>
</span></span><span style="display:flex;"><span>WantedBy<span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">default.target</span>
</span></span></code></pre></div><p>Next you would need to add an environment variable <code>SSH_AUTH_SOCK</code> to your shell.
There is currently no consensus on how to do it, but plenty of opinionated idealists with ideas of why a way works isn&rsquo;t what you should use.
At the moment, the way that evidently works best is to add a file in <code>~/.config/environment.d/</code>,</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>echo <span style="color:#a5d6ff">&#39;SSH_AUTH_SOCK=&#34;${XDG_RUNTIME_DIR}/ssh-agent.socket&#34;&#39;</span> &gt;&gt; ~/.config/environment.d/ssh-askpass.conf
</span></span></code></pre></div><p>I cannot emphasise enough how badly user-specific environment variables are handled on GNU.
Particularly those pertaining to the early programs like window managers and security agents.</p>
<p>Now you need to log out and in again.</p>
<p>::: info
A Restart is what I&rsquo;d recommend for that purpose, on Arch Linux it might have other benefits, particularly if you&rsquo;ve ran <code>pacman -Syu</code> before.
:::</p>
<p>::: tip
To verify that things work now, run</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ssh-add -l
</span></span></code></pre></div><p>if it produces something like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#8b949e">The agent has no identities.
</span></span></span></code></pre></div><p>then we&rsquo;re good</p>
<p>:::</p>
<h2 id="setting-up-keepassxc">
  Setting up KeePassXC
  <a class="heading-link" href="#setting-up-keepassxc">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>::: tip
We are largely going to closely follow the <a href="https://github.com/keepassxreboot/keepassxc/blob/develop/docs/topics/SSHAgent.adoc"  class="external-link" target="_blank" rel="noopener">upstream documentation</a>: if the two documents differ, I&rsquo;d recommend you more closely follow the upstream document rather than the steps outlined here.
:::</p>
<h2 id="pinentry-for-gnu-privacy-guard-gnupg">
  <code>pinentry</code> for GNU Privacy Guard (<code>gnupg</code>)
  <a class="heading-link" href="#pinentry-for-gnu-privacy-guard-gnupg">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>This is probably something that could be left for another post, but I&rsquo;m adding it here for posterity.
Firstly, there&rsquo;s an asymmetry between the <code>pinentry</code> programs.
<code>pinentry-qt</code> is, as always, an afterthought.
<code>pinentry-gnome3</code> has integration with the secret services, meaning that you could enable KeePassXC&rsquo;s secret service integration, and be done with it.</p>
<p>The easiest way to achieve it, is by setting the following in <code>.gnupg/gpg-agent.conf</code></p>
<pre tabindex="0"><code class="language-conf" data-lang="conf">pinentry-program /usr/bin/pinentry-gnome3
</code></pre><p>This program, at the time of writing will not start, you need to also install <code>gcr</code> of the third version.</p>
<p>At this point, you might want to disable the KDE wallet subsystem, so that it&rsquo;s not exactly competing with KeePassXC, and enable the service with KeePassXC.</p>
<p>The best thing to do is to now test things!</p>

      </div>


      <footer>
        


        
        
        
        
        
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      2023 -
    
    2025
     Aleksandr Petrosyan 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
