<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  A zeroth-order guide to privelege escalation · Aleksandr Petrosyan
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Aleksandr Petrosyan">
<meta name="description" content="This is not meant to be a detailed comparison, just a
back-of-the-envelope guide explaining why you should or shouldn&rsquo;t use
a particular program in particular circumstances.

  sudo
  
    
    Link to heading
  

This program is sadly, considered the default on most GNU&#43;Linux
distributions.  It is a rather complex beast, despite the fact that it
is, for lack of a better term, the original systemd, an ugly piece
of code that almost everyone hates, but still runs for some reason.
Not to say that systemd is bad, these days it&rsquo;s perhaps what it was
meant to be all along, but sudo is something that you likely need to
know about, but also something that you should avoid if possible on
your own machines.">
<meta name="keywords" content="blog,developer,personal">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="A zeroth-order guide to privelege escalation">
  <meta name="twitter:description" content="This is not meant to be a detailed comparison, just a back-of-the-envelope guide explaining why you should or shouldn’t use a particular program in particular circumstances.
sudo Link to heading This program is sadly, considered the default on most GNU&#43;Linux distributions. It is a rather complex beast, despite the fact that it is, for lack of a better term, the original systemd, an ugly piece of code that almost everyone hates, but still runs for some reason. Not to say that systemd is bad, these days it’s perhaps what it was meant to be all along, but sudo is something that you likely need to know about, but also something that you should avoid if possible on your own machines.">

<meta property="og:url" content="http://localhost:1313/posts/privilege-escalation/">
  <meta property="og:site_name" content="Aleksandr Petrosyan">
  <meta property="og:title" content="A zeroth-order guide to privelege escalation">
  <meta property="og:description" content="This is not meant to be a detailed comparison, just a back-of-the-envelope guide explaining why you should or shouldn’t use a particular program in particular circumstances.
sudo Link to heading This program is sadly, considered the default on most GNU&#43;Linux distributions. It is a rather complex beast, despite the fact that it is, for lack of a better term, the original systemd, an ugly piece of code that almost everyone hates, but still runs for some reason. Not to say that systemd is bad, these days it’s perhaps what it was meant to be all along, but sudo is something that you likely need to know about, but also something that you should avoid if possible on your own machines.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-12T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-06-12T00:00:00+00:00">




<link rel="canonical" href="http://localhost:1313/posts/privilege-escalation/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="/img/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      Aleksandr Petrosyan
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/privilege-escalation/">
              A zeroth-order guide to privelege escalation
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2024-06-12T00:00:00Z">
                June 12, 2024
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              5-minute read
            </span>
          </div>
          
          
          
        </div>
      </header>

      <div class="post-content">
        
        <p>This is not meant to be a detailed comparison, just a
back-of-the-envelope guide explaining why you should or shouldn&rsquo;t use
a particular program in particular circumstances.</p>
<h3 id="sudo">
  <code>sudo</code>
  <a class="heading-link" href="#sudo">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>This program is sadly, considered the default on most GNU+Linux
distributions.  It is a rather complex beast, despite the fact that it
is, for lack of a better term, the original <code>systemd</code>, an ugly piece
of code that almost everyone hates, but still runs for some reason.
Not to say that <code>systemd</code> is bad, these days it&rsquo;s perhaps what it was
meant to be all along, but <code>sudo</code> is something that you likely need to
know about, but also something that you should avoid if possible on
your own machines.</p>
<p>Contrary too popular belief, this program is not built-in.  It is, in
fact, not even installed, unless explicitly specified on
newbiew-friendly advanced distributions such as ArchLinux.</p>
<p>So what do you need to know about <code>sudo</code>.  Well, it&rsquo;s an SUID binary.
99% of the codebase is completely inert, in that you don&rsquo;t actually
use most of it, all you use if for is privelege escalation for the
<code>root</code> user.</p>
<p>Is this a bad thing?  Yes.  The program, by sheer size is a huge
attack surface.  If you can avoid it, please do.</p>
<p>One thing I should mention is that <code>sudo</code> comes with <code>sudoedit</code>, which
is a program that would have been nice when editors couldn&rsquo;t privelege
escalate on their own.  Most editos are either used as <code>sudo vim</code> or
can do privelege escalation internally, such as <code>kate</code> and <code>emacs</code>.</p>
<p><code>sudo -E</code> is an important case where the environment must be
preserved, for example, when you&rsquo;re doing something that the original
<code>sudo</code> is ill-equipped to do, that is running a graphical application.
The implementation is considered sub-par, to the point, where both KDE
and Gnome had their own replacements, <code>kdesudo</code> and <code>gsudo</code>.  Both
deprecated by the way.  The consensus, is that if you have the
technical budget to create a graphical program, you surely also have
the technical budget to do privelege escalation properly.</p>
<p>This program is configured via the <code>sudoers</code> file.  The trouble with
that file, is that it has an obtuse syntax, and must be edited with a
special program: <code>visudo</code>.  Don&rsquo;t you feel like you&rsquo;re safe already?</p>
<h3 id="doas">
  Doas
  <a class="heading-link" href="#doas">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Doas is what <code>sudo</code> should have been.  It&rsquo;s a TUI-only alternative to
<code>sudo</code>, that uses the same mechanism, but by virtue of being much
smaller, and better maintained, seems to have fewer unknown
vulnerabilities.</p>
<p>The entire man page for <code>doas</code> fits into half a screen.  Its usage is
small-enough so that people undestand what it actually does.</p>
<p>The configuration file is both straightforward, and can be specified
via the <code>-c</code> flag, which usually means that the user can easily change
it.  The greatest improvement that <code>doas</code> offers over <code>sudo</code> is that
it actually explains much of the stuff that is buried deep in the
abstractions.</p>
<p>I found it much easier to try and set up particular rules for
particular programs.  If you ask me, just use <code>doas</code> if you have the
ability to do so.</p>
<h3 id="polkit">
  Polkit
  <a class="heading-link" href="#polkit">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>This is what I use.  This program is likely to come pre-installed.  It
is what <code>systemd</code> falls back on, if you try to perform an action that
needs root priveleges, but you forgot to use <code>sudo</code>.  Its main
advantage is that it lives in the modern day and age.  It is a program
that integrates with your desktop environment, and you can make WMs
work just as well.  You can make rules in &hellip;. ewww&hellip; JavaScript.
But other than that, the program is fairly straightforward.</p>
<p>Ideally, it doesn&rsquo;t require any input.  Any operation that must
require privelege escalation, must be performed in an isolated process
and the privelege must be de-escalated as quickly as possible.  That
is not something that you can do, while keeping the UX of <code>sudo</code>,
where <code>sudo make</code> has different abilities to just regular <code>make</code>.</p>
<p>One reason I choose to use it as the SUID binary with <code>paru</code>, is
because I often use it to compile <code>emacs-git</code>, and that takes a while.
I often put it in the background and do other stuff.  On more than one
occasion, I had to re-run the compilation several times with <code>sudo</code>,
because I missed the time when the terminal prompted me for input.
Sure, I now know that <code>konsole</code> has a way to monitor for silence, but
that is neither here nor there.  Add <code>pkexec</code> as a drop-in replacement
for <code>sudo</code> and you&rsquo;re golden.</p>
<p>As an added bonus, you have the option to do this:</p>
<pre tabindex="0"><code>WRAPPER USAGE
       To avoid modifying existing software to prefix their command-line invocations with pkexec, it&#39;s possible to use pkexec in a she-bang wrapper[1]
       like this:

           #!/usr/bin/pkexec /usr/bin/python

           import os
           import sys

           print &#34;Hello, I&#39;m running as uid %d&#34;%(os.getuid())

           for n in range(len(sys.argv)):
               print &#34;arg[%d]=‘%s&#39;&#34;%(n, sys.argv[n])

       If this script is installed into /usr/bin/my-pk-test, then the following annotations

             [...]
             &lt;annotate key=&#34;org.freedesktop.policykit.exec.path&#34;&gt;/usr/bin/python&lt;/annotate&gt;
             &lt;annotate key=&#34;org.freedesktop.policykit.exec.argv1&#34;&gt;/usr/bin/my-pk-test&lt;/annotate&gt;
             [...]

       can be used to select the appropriate polkit action. Be careful to get the latter annotation right, otherwise it will match any pkexec invocation
       of /usr/bin/python scripts.
</code></pre><p>So the user experience can be improved at the source, and packaged up.
For obvious reasons, the rules need to be edited in some way, and the
mornonic choice of using XML is a pain, but the work in making the
system be standard, be reliable, and be supported by multiple
applications is already done.  I think that the <code>suckless</code> crowd would
find it far easier to patch in a different file type, rather than try
and implement their own, inferior design.</p>
<h3 id="systemd-run0">
  Systemd run0
  <a class="heading-link" href="#systemd-run0">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>This program is quite an interesting beast.  I tried to hate it, and
almost managed to do so, but at some point I realised that it is
actually a very good substitute for <code>sudo</code>.  It is <em>not</em> an SUID
program, and as a consequence, the security of it, in places where
SUID style privelege escalation would be problematic, and re-writing
programs to use something like <code>polkit</code> would be difficult, <code>run0</code>
finds a nice niche.</p>
<p>I can see myself using <code>run0</code> and <code>polkit</code> exclusively.  But the
program hasn&rsquo;t been well-tested, so feel free to experiment with it,
but don&rsquo;t blame me if it breaks.  It&rsquo;s all very early days.</p>

      </div>


      <footer>
        


        
        
        
        
        
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      2023 -
    
    2025
     Aleksandr Petrosyan 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
